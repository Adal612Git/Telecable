<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stack Tecnol√≥gico & Plan de Implementaci√≥n</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
        }

        .card.urgent {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #fff 0%, #ffeaea 100%);
        }

        .card.important {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fff 0%, #fff4e3 100%);
        }

        .card.completed {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #fff 0%, #e8f6ef 100%);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            font-size: 1.3em;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tech-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .tech-item:hover {
            transform: translateY(-5px);
        }

        .tech-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .phase-timeline {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }

        .phase {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
            position: relative;
        }

        .phase::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: #3498db;
            border-radius: 50%;
            border: 3px solid white;
        }

        .phase-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .phase-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .diagram-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .priority-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .priority-high { background: #e74c3c; color: white; }
        .priority-medium { background: #f39c12; color: white; }
        .priority-low { background: #27ae60; color: white; }

        .checklist {
            list-style: none;
            margin: 15px 0;
        }

        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist li:before {
            content: '‚úì';
            color: #27ae60;
            font-weight: bold;
        }

        .command {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .tech-stack {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Stack Tecnol√≥gico & Plan de Implementaci√≥n</h1>
            <div class="subtitle">Sistema de Gesti√≥n ISP - Gu√≠a Completa de Desarrollo y Despliegue</div>
        </div>

        <!-- Stack Tecnol√≥gico -->
        <div class="card">
            <h2>üõ† Stack Tecnol√≥gico Completo</h2>
            
            <div class="tech-stack">
                <div class="tech-item">
                    <div class="tech-icon">‚öõÔ∏è</div>
                    <h3>Frontend Web</h3>
                    <p><strong>Vite + React 18</strong></p>
                    <p>TypeScript, React Router, Zustand (State Management)</p>
                    <p>Tailwind CSS, React Hook Form</p>
                </div>
                
                <div class="tech-item">
                    <div class="tech-icon">üì±</div>
                    <h3>Mobile App</h3>
                    <p><strong>Expo + React Native</strong></p>
                    <p>TypeScript, React Navigation</p>
                    <p>NativeWind (Tailwind para RN)</p>
                </div>
                
                <div class="tech-item">
                    <div class="tech-icon">üîß</div>
                    <h3>Backend API</h3>
                    <p><strong>Node.js + Express</strong></p>
                    <p>TypeScript, JWT Authentication</p>
                    <p>Redis para colas, Socket.io para real-time</p>
                </div>
                
                <div class="tech-item">
                    <div class="tech-icon">üóÑÔ∏è</div>
                    <h3>Base de Datos</h3>
                    <p><strong>PostgreSQL 15</strong></p>
                    <p>Prisma ORM, Redis para cache/colas</p>
                    <p>PgBouncer para connection pooling</p>
                </div>
                
                <div class="tech-item">
                    <div class="tech-icon">üê≥</div>
                    <h3>Infraestructura</h3>
                    <p><strong>Docker + Docker Compose</strong></p>
                    <p>Nginx como reverse proxy</p>
                    <p>SSL con Let's Encrypt</p>
                </div>
                
                <div class="tech-item">
                    <div class="tech-icon">üîå</div>
                    <h3>Integraciones</h3>
                    <p><strong>Mikrotik API</strong> (node-routeros)</p>
                    <p><strong>Stripe/OpenPay</strong> para pagos</p>
                    <p><strong>Twilio</strong> para SMS/WhatsApp</p>
                </div>
            </div>
        </div>

        <!-- Arquitectura de Despliegue -->
        <div class="card">
            <h2>üèó Arquitectura de Despliegue</h2>
            
            <div class="diagram-container">
                <div class="mermaid">
flowchart TB
    subgraph ClientLayer [Capa Cliente]
        WebApp[Web App<br/>Vite + React]
        MobileApp[Mobile App<br/>Expo]
        ServiceWorker[Service Worker]
    end

    subgraph ServerLayer [Servidor Cliente - Ubuntu 22.04]
        subgraph ProxyLayer [Capa Proxy]
            Nginx[Nginx<br/>Reverse Proxy + SSL]
            SSL[Let's Encrypt<br/>Certificados SSL]
        end

        subgraph AppLayer [Capa Aplicaci√≥n]
            Frontend[Frontend Build<br/>Static Files]
            Backend[Backend API<br/>Node.js + Express]
            Redis[Redis Server<br/>Cache & Colas]
        end

        subgraph DataLayer [Capa Datos]
            PostgreSQL[PostgreSQL 15<br/>Base de datos principal]
            PgBouncer[PgBouncer<br/>Connection Pooling]
        end
    end

    subgraph ExternalServices [Servicios Externos]
        Mikrotik[Mikrotik Router<br/>API Integration]
        PaymentGateway[Pasarela de Pagos<br/>Stripe/OpenPay]
        SMSProvider[Proveedor SMS<br/>Twilio]
        DNS[DNS Cliente<br/>Configuraci√≥n personalizada]
    end

    ClientLayer --> Nginx
    Nginx --> Frontend
    Nginx --> Backend
    Backend --> Redis
    Backend --> PgBouncer
    PgBouncer --> PostgreSQL
    
    Backend --> Mikrotik
    Backend --> PaymentGateway
    Backend --> SMSProvider
    
    DNS --> Nginx
                </div>
            </div>
        </div>

        <!-- Plan de Implementaci√≥n por Fases -->
        <div class="card important">
            <h2>üìÖ Plan de Implementaci√≥n - 8 Fases</h2>
            
            <div class="phase-timeline">
                <div class="phase">
                    <div class="phase-header">
                        <div class="phase-number">1</div>
                        <h3>Fase 1: Setup Inicial & Infraestructura <span class="priority-badge priority-high">SEMANA 1</span></h3>
                    </div>
                    <div class="checklist">
                        <li>Configurar servidor Ubuntu 22.04</li>
                        <li>Instalar Docker y Docker Compose</li>
                        <li>Configurar DNS del cliente</li>
                        <li>Setup de Nginx y SSL</li>
                        <li>Configurar PostgreSQL y Redis</li>
                    </div>
                    <div class="command">
                        # Comandos iniciales del servidor<br>
                        ssh usuario@servidor-cliente<br>
                        sudo apt update && sudo apt upgrade -y<br>
                        curl -fsSL https://get.docker.com -o get-docker.sh<br>
                        sudo sh get-docker.sh
                    </div>
                </div>

                <div class="phase">
                    <div class="phase-header">
                        <div class="phase-number">2</div>
                        <h3>Fase 2: Backend Core & Autenticaci√≥n <span class="priority-badge priority-high">SEMANA 2-3</span></h3>
                    </div>
                    <div class="checklist">
                        <li>Estructura base del backend con TypeScript</li>
                        <li>Sistema de autenticaci√≥n JWT</li>
                        <li>Modelos de datos con Prisma</li>
                        <li>API de usuarios y roles</li>
                        <li>Sistema de auditor√≠a y logs</li>
                    </div>
                </div>

                <div class="phase">
                    <div class="phase-header">
                        <div class="phase-number">3</div>
                        <h3>Fase 3: M√≥dulo de Clientes & Planes <span class="priority-badge priority-medium">SEMANA 4</span></h3>
                    </div>
                    <div class="checklist">
                        <li>CRUD completo de clientes</li>
                        <li>Gesti√≥n de planes de servicio</li>
                        <li>Dashboard administrativo b√°sico</li>
                        <li>Integraci√≥n inicial con Mikrotik</li>
                    </div>
                </div>

                <div class="phase">
                    <div class="phase-header">
                        <div class="phase-number">4</div>
                        <h3>Fase 4: Sistema de Facturaci√≥n <span class="priority-badge priority-high">SEMANA 5-6</span></h3>
                    </div>
                    <div class="checklist">
                        <li>Generaci√≥n autom√°tica de facturas</li>
                        <li>Integraci√≥n con pasarela de pagos</li>
                        <li>Sistema de webhooks para pagos</li>
                        <li>M√≥dulo de cortes por morosidad</li>
                        <li>Reactivaci√≥n autom√°tica</li>
                    </div>
                </div>

                <div class="phase">
                    <div class="phase-header">
                        <div class="phase-number">5</div>
                        <h3>Fase 5: Ticketing & Soporte <span class="priority-badge priority-medium">SEMANA 7</span></h3>
                    </div>
                    <div class="checklist">
                        <li>Sistema completo de tickets</li>
                        <li>Kanban para jefes t√©cnicos</li>
                        <li>Checklist para t√©cnicos</li>
                        <li>Notificaciones push y SMS</li>
                    </div>
                </div>

                <div class="phase">
                    <div class="phase-header">
                        <div class="phase-number">6</div>
                        <h3>Fase 6: Frontend Web Completo <span class="priority-badge priority-medium">SEMANA 8-9</span></h3>
                    </div>
                    <div class="checklist">
                        <li>SPA con Vite + React</li>
                        <li>Vistas por rol (Due√±o, Cobranza, T√©cnico)</li>
                        <li>Interfaz responsive con Tailwind</li>
                        <li>Soporte offline con Service Worker</li>
                    </div>
                </div>

                <div class="phase">
                    <div class="phase-header">
                        <div class="phase-number">7</div>
                        <h3>Fase 7: Mobile App <span class="priority-badge priority-low">SEMANA 10</span></h3>
                    </div>
                    <div class="checklist">
                        <li>App m√≥vil con Expo</li>
                        <li>Vista t√©cnica para field work</li>
                        <li>App cliente para autoservicio</li>
                        <li>Checklist offline</li>
                    </div>
                </div>

                <div class="phase">
                    <div class="phase-header">
                        <div class="phase-number">8</div>
                        <h3>Fase 8: Producci√≥n & Monitoreo <span class="priority-badge priority-high">SEMANA 11</span></h3>
                    </div>
                    <div class="checklist">
                        <li>Despliegue a producci√≥n</li>
                        <li>Configuraci√≥n de backups</li>
                        <li>Monitoreo y logs</li>
                        <li>Documentaci√≥n final</li>
                        <li>Capacitaci√≥n al cliente</li>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuraci√≥n del Servidor -->
        <div class="card">
            <h2>üñ• Configuraci√≥n del Servidor del Cliente</h2>
            
            <h3>Requisitos del Servidor:</h3>
            <div class="checklist">
                <li><strong>SO:</strong> Ubuntu Server 22.04 LTS</li>
                <li><strong>CPU:</strong> 4 cores m√≠nimo</li>
                <li><strong>RAM:</strong> 8GB m√≠nimo (16GB recomendado)</li>
                <li><strong>Disco:</strong> 100GB SSD</li>
                <li><strong>Red:</strong> IP p√∫blica est√°tica</li>
            </div>

            <h3>Configuraci√≥n Inicial - Script de Setup:</h3>
            <div class="command">
#!/bin/bash
# setup-server.sh

# Actualizar sistema
apt update && apt upgrade -y

# Instalar Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
usermod -aG docker $USER

# Instalar Docker Compose
curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# Crear estructura de directorios
mkdir -p /opt/isp-system/{postgres,redis,app,nginx,ssl,backups}

# Configurar firewall
ufw allow ssh
ufw allow 80
ufw allow 443
ufw enable
            </div>
        </div>

        <!-- Docker Compose Configuration -->
        <div class="card">
            <h2>üê≥ Docker Compose - Stack Completo</h2>
            
            <div class="command">
# docker-compose.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - backend
      - frontend
    networks:
      - isp-network

  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: isp_system
      POSTGRES_USER: isp_user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backups:/backups
    networks:
      - isp-network

  redis:
    image: redis:alpine
    volumes:
      - redis_data:/data
    networks:
      - isp-network

  backend:
    build: ./backend
    environment:
      NODE_ENV: production
      DATABASE_URL: ${DATABASE_URL}
      REDIS_URL: ${REDIS_URL}
      JWT_SECRET: ${JWT_SECRET}
    volumes:
      - ./logs:/app/logs
    networks:
      - isp-network
    depends_on:
      - postgres
      - redis

  frontend:
    build: ./frontend
    volumes:
      - frontend_build:/app/dist
    networks:
      - isp-network

volumes:
  postgres_data:
  redis_data:
  frontend_build:

networks:
  isp-network:
    driver: bridge
            </div>
        </div>

        <!-- Configuraci√≥n DNS -->
        <div class="card">
            <h2>üåê Configuraci√≥n DNS del Cliente</h2>
            
            <div class="warning">
                <strong>‚ö†Ô∏è IMPORTANTE:</strong> El cliente debe configurar estos registros en su panel DNS
            </div>

            <h3>Registros DNS Requeridos:</h3>
            <div class="command">
# Registro A - Dominio principal
Nombre: @
Tipo: A
Valor: [IP_P√öBLICA_DEL_SERVIDOR]
TTL: 3600

# Registro A - Subdominio API
Nombre: api
Tipo: A
Valor: [IP_P√öBLICA_DEL_SERVIDOR]
TTL: 3600

# Registro A - Subdominio App M√≥vil
Nombre: mobile
Tipo: A
Valor: [IP_P√öBLICA_DEL_SERVIDOR]
TTL: 3600

# Registro CNAME - WWW
Nombre: www
Tipo: CNAME
Valor: @
TTL: 3600
            </div>
        </div>

        <!-- Dependencias y M√≥dulos -->
        <div class="card">
            <h2>üì¶ Dependencias Clave del Proyecto</h2>
            
            <h3>Backend (package.json):</h3>
            <div class="command">
{
  "dependencies": {
    "express": "^4.18.2",
    "typescript": "^5.0.0",
    "prisma": "^5.0.0",
    "@prisma/client": "^5.0.0",
    "jsonwebtoken": "^9.0.0",
    "bcryptjs": "^2.4.3",
    "redis": "^4.6.0",
    "bull": "^4.11.0",
    "node-routeros": "^2.3.0",
    "stripe": "^12.0.0",
    "twilio": "^4.0.0",
    "socket.io": "^4.7.0",
    "multer": "^1.4.5",
    "express-rate-limit": "^6.8.0"
  }
}
            </div>

            <h3>Frontend (package.json):</h3>
            <div class="command">
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.14.0",
    "zustand": "^4.3.0",
    "axios": "^1.4.0",
    "tailwindcss": "^3.3.0",
    "react-hook-form": "^7.45.0",
    "lucide-react": "^0.263.0",
    "date-fns": "^2.30.0",
    "workbox-core": "^7.0.0"
  }
}
            </div>
        </div>

        <!-- Checklist Pre-Producci√≥n -->
        <div class="card urgent">
            <h2>‚úÖ Checklist Pre-Lanzamiento</h2>
            
            <div class="checklist">
                <li>‚úÖ Configuraci√≥n de DNS completada</li>
                <li>‚úÖ Certificados SSL instalados y funcionando</li>
                <li>‚úÖ Backups autom√°ticos configurados</li>
                <li>‚úÖ Monitoreo de servicios implementado</li>
                <li>‚úÖ Pruebas de carga completadas</li>
                <li>‚úÖ Documentaci√≥n de usuario creada</li>
                <li>‚úÖ Plan de rollback preparado</li>
                <li>‚úÖ Capacitaci√≥n al equipo del cliente</li>
                <li>‚úÖ Comunicaci√≥n de mantenimiento enviada</li>
                <li>‚úÖ Checklist de seguridad revisado</li>
            </div>
        </div>

        <!-- Scripts de Mantenimiento -->
        <div class="card">
            <h2>üîß Scripts de Mantenimiento</h2>
            
            <h3>Backup Autom√°tico:</h3>
            <div class="command">
#!/bin/bash
# backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/opt/isp-system/backups"

# Backup de PostgreSQL
docker exec postgres pg_dump -U isp_user isp_system > $BACKUP_DIR/db_backup_$DATE.sql

# Backup de archivos importantes
tar -czf $BACKUP_DIR/app_backup_$DATE.tar.gz /opt/isp-system/app

# Rotar backups (mantener √∫ltimos 7 d√≠as)
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete
            </div>

            <h3>Monitoreo de Servicios:</h3>
            <div class="command">
#!/bin/bash
# health-check.sh

services=("nginx" "postgres" "redis" "backend")

for service in "${services[@]}"; do
    if docker ps | grep -q $service; then
        echo "‚úÖ $service est√° funcionando"
    else
        echo "‚ùå $service est√° ca√≠do"
        # Reinciar servicio
        docker-compose up -d $service
    fi
done
            </div>
        </div>

        <!-- Consideraciones de Seguridad -->
        <div class="card important">
            <h2>üîí Consideraciones de Seguridad</h2>
            
            <div class="checklist">
                <li>‚úÖ Firewall configurado (solo puertos 80, 443, 22)</li>
                <li>‚úÖ Contrase√±as fuertes en variables de entorno</li>
                <li>‚úÖ Rate limiting en API endpoints</li>
                <li>‚úÖ Validaci√≥n de entrada en todos los formularios</li>
                <li>‚úÖ Headers de seguridad en Nginx</li>
                <li>‚úÖ Backups encriptados</li>
                <li>‚úÖ Monitoreo de intentos de acceso</li>
                <li>‚úÖ Actualizaciones de seguridad autom√°ticas</li>
            </div>
        </div>

    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>
</html>