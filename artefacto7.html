<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artefacto 5: Diagramas de Arquitectura (Modelo C4)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        
        .artifact-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }
        
        h1 {
            font-size: 2.4rem;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .content {
            padding: 40px;
        }
        
        .level-section {
            margin-bottom: 50px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #3498db;
        }
        
        .level-title {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .level-description {
            color: #555;
            margin-bottom: 25px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .system-box {
            background: white;
            border: 3px solid #3498db;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .system-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .system-description {
            color: #666;
            line-height: 1.5;
        }
        
        .entities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .entity-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #27ae60;
        }
        
        .entity-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .entity-description {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .relationship {
            background: #e8f4fd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }
        
        .relationship-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .containers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }
        
        .container-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #e74c3c;
        }
        
        .container-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .container-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .container-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .container-responsibility {
            color: #666;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .component-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #9b59b6;
        }
        
        .component-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .component-description {
            color: #666;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .verification-section {
            background: #fff3e0;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
            border-left: 4px solid #f39c12;
        }
        
        .verification-title {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .verification-list {
            list-style-type: none;
            padding-left: 0;
        }
        
        .verification-list li {
            margin-bottom: 12px;
            padding-left: 25px;
            position: relative;
        }
        
        .verification-list li:before {
            content: "‚úÖ";
            position: absolute;
            left: 0;
        }
        
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .entities-grid,
            .containers-grid,
            .components-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="artifact-badge">5/9</div>
            <h1>Diagramas de Arquitectura (Modelo C4)</h1>
            <p class="subtitle">Descripci√≥n de la arquitectura del "Sistema de Gesti√≥n ISP" usando el modelo C4</p>
        </header>
        
        <div class="content">
            <!-- Nivel 1: Diagrama de Contexto -->
            <div class="level-section">
                <h2 class="level-title">üè¢ Nivel 1: Diagrama de Contexto del Sistema</h2>
                <p class="level-description">Este diagrama muestra el sistema como una caja negra y c√≥mo interact√∫a con los usuarios y otros sistemas.</p>
                
                <div class="system-box">
                    <div class="system-title">üì¶ Sistema de Gesti√≥n ISP (SG-ISP)</div>
                    <div class="system-description">Plataforma centralizada para gestionar clientes, facturaci√≥n, soporte t√©cnico y control de red de un ISP.</div>
                </div>
                
                <h3 style="color: #2c3e50; margin: 25px 0 15px;">üë• Personas (Usuarios del Sistema)</h3>
                <div class="entities-grid">
                    <div class="entity-card">
                        <div class="entity-title">üë§ Cliente (Vecino)</div>
                        <div class="entity-description">Consulta/paga facturas y crea tickets de soporte</div>
                    </div>
                    <div class="entity-card">
                        <div class="entity-title">üë∑ T√©cnico (Chuy)</div>
                        <div class="entity-description">Recibe y resuelve tickets de soporte en campo</div>
                    </div>
                    <div class="entity-card">
                        <div class="entity-title">üë®‚Äçüíº Admin de Campo (Sergio)</div>
                        <div class="entity-description">Asigna tickets y monitorea la operaci√≥n</div>
                    </div>
                    <div class="entity-card">
                        <div class="entity-title">üë©‚Äçüíº Cobranza (Laura)</div>
                        <div class="entity-description">Gestiona altas, facturas y pagos. Ejecuta cortes/reactivaciones</div>
                    </div>
                    <div class="entity-card">
                        <div class="entity-title">üëë Due√±o (Roberto)</div>
                        <div class="entity-description">Ve dashboards y reportes de la salud del negocio</div>
                    </div>
                </div>
                
                <h3 style="color: #2c3e50; margin: 25px 0 15px;">üîó Sistemas Externos</h3>
                <div class="entities-grid">
                    <div class="entity-card">
                        <div class="entity-title">üõú Routers Mikrotik (MTIK)</div>
                        <div class="relationship">
                            <div class="relationship-title">Relaci√≥n:</div>
                            <div class="entity-description">El SG-ISP le env√≠a comandos (API/SSH) para cortar y reactivar clientes (a√±adir/quitar de address lists)</div>
                        </div>
                    </div>
                    <div class="entity-card">
                        <div class="entity-title">üí≥ Pasarela de Pagos (Stripe/MercadoPago)</div>
                        <div class="relationship">
                            <div class="relationship-title">Relaci√≥n (Doble V√≠a):</div>
                            <div class="entity-description">
                                ‚Ä¢ El SG-ISP redirige al Cliente a la pasarela<br>
                                ‚Ä¢ La pasarela env√≠a un webhook (notificaci√≥n) al SG-ISP cuando el pago es exitoso
                            </div>
                        </div>
                    </div>
                    <div class="entity-card">
                        <div class="entity-title">üí¨ API de WhatsApp (Twilio/Meta)</div>
                        <div class="relationship">
                            <div class="relationship-title">Relaci√≥n:</div>
                            <div class="entity-description">El SG-ISP le env√≠a notificaciones (recordatorios de pago, confirmaci√≥n de tickets) para ser entregadas a los Clientes</div>
                        </div>
                    </div>
                    <div class="entity-card">
                        <div class="entity-title">üó∫Ô∏è Google Maps / Waze</div>
                        <div class="relationship">
                            <div class="relationship-title">Relaci√≥n:</div>
                            <div class="entity-description">La App de T√©cnico consume la API de mapas para calcular rutas a los domicilios de los tickets</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Nivel 2: Diagrama de Contenedores -->
            <div class="level-section">
                <h2 class="level-title">üì¶ Nivel 2: Diagrama de Contenedores</h2>
                <p class="level-description">Este diagrama hace "zoom" dentro de la caja negra del SG-ISP para mostrar los principales bloques de construcci√≥n (microservicios, bases de datos, frontends).</p>
                
                <div class="system-box">
                    <div class="system-title">üèóÔ∏è Frontera del Sistema (Desplegado en el Servidor del Cliente)</div>
                </div>
                
                <h3 style="color: #2c3e50; margin: 25px 0 15px;">üé® Apps Frontend (Contenedores)</h3>
                <div class="containers-grid">
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">1</div>
                            <div class="container-title">Panel de Admin/Cobranza</div>
                        </div>
                        <div class="container-responsibility">Web App (React/Next.js) - El "cerebro" visual para Due√±o, Cobranza y Jefe de T√©cnicos</div>
                    </div>
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">2</div>
                            <div class="container-title">Portal de Cliente</div>
                        </div>
                        <div class="container-responsibility">PWA (React) - App para que el cliente pague y reporte fallas</div>
                    </div>
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">3</div>
                            <div class="container-title">App de T√©cnico</div>
                        </div>
                        <div class="container-responsibility">PWA Offline-First (React) - App m√≥vil simple para que el t√©cnico vea y resuelva tickets</div>
                    </div>
                </div>
                
                <h3 style="color: #2c3e50; margin: 25px 0 15px;">‚öôÔ∏è El Backend (Contenedores)</h3>
                <div class="containers-grid">
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">4</div>
                            <div class="container-title">API Gateway (Node.js - NestJS)</div>
                        </div>
                        <div class="container-responsibility">Punto de entrada √∫nico. Autentica todas las peticiones (valida tokens). Enruta el tr√°fico al microservicio correcto. Proporciona una √∫nica URL (api.miisp.com)</div>
                    </div>
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">5</div>
                            <div class="container-title">Microservicio: Autenticaci√≥n (Node.js)</div>
                        </div>
                        <div class="container-responsibility">Maneja el login, registro, recuperaci√≥n de contrase√±a y gesti√≥n de roles y permisos. Emite los tokens (JWT) que usa el Gateway</div>
                    </div>
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">6</div>
                            <div class="container-title">Microservicio: Clientes y Facturaci√≥n (Node.js)</div>
                        </div>
                        <div class="container-responsibility">El "Core". Maneja el CRUD de Clientes y Planes. Contiene la l√≥gica de negocio para generar facturas (el cron job) y procesar pagos (recibir el webhook)</div>
                    </div>
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">7</div>
                            <div class="container-title">Microservicio: Ticketing (Node.js)</div>
                        </div>
                        <div class="container-responsibility">Maneja el ciclo de vida de los tickets de soporte (creaci√≥n, asignaci√≥n, resoluci√≥n, notas)</div>
                    </div>
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">8</div>
                            <div class="container-title">Microservicio: Control de Red (MTIK) (Node.js)</div>
                        </div>
                        <div class="container-responsibility">El √∫nico servicio que tiene permiso y sabe c√≥mo hablar con los routers Mikrotik. Expone endpoints simples (ej. /api/v1/mtik/cortar)</div>
                    </div>
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">9</div>
                            <div class="container-title">Microservicio: Notificaciones (Node.js)</div>
                        </div>
                        <div class="container-responsibility">Gestiona el env√≠o de emails y WhatsApp. Recibe peticiones de otros servicios (ej. "enviar recordatorio de pago al cliente X")</div>
                    </div>
                </div>
                
                <h3 style="color: #2c3e50; margin: 25px 0 15px;">üíæ Almacenamiento (Contenedores)</h3>
                <div class="containers-grid">
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">10</div>
                            <div class="container-title">Base de Datos Principal (PostgreSQL)</div>
                        </div>
                        <div class="container-responsibility">Fuente de la verdad. Almacena los datos de Clientes, Facturas, Tickets y Usuarios</div>
                    </div>
                    <div class="container-card">
                        <div class="container-header">
                            <div class="container-icon">11</div>
                            <div class="container-title">Cach√© / Colas (Redis)</div>
                        </div>
                        <div class="container-responsibility">Almacena sesiones de usuario (cach√©) y gestiona las colas de notificaciones (para fiabilidad)</div>
                    </div>
                </div>
                
                <div class="verification-section">
                    <h3 class="verification-title">üîç Verificaci√≥n de Puntos Clave (Nivel 2)</h3>
                    <ul class="verification-list">
                        <li><strong>¬øResponsabilidad √önica?</strong> S√≠. El servicio de Tickets no sabe nada de Mikrotik. El servicio de Facturaci√≥n no sabe c√≥mo asignar un ticket.</li>
                        <li><strong>¬øDependencias M√≠nimas?</strong> S√≠. Los servicios se comunican a trav√©s del API Gateway.</li>
                        <li><strong>¬øComunicaci√≥n S√≠ncrona/As√≠ncrona?</strong>
                            <br>‚Ä¢ <strong>S√≠ncrona (HTTP):</strong> La mayor√≠a de las llamadas (ej. App Cliente pide su factura)
                            <br>‚Ä¢ <strong>As√≠ncrona (Colas/Eventos):</strong> 
                            <br>&nbsp;&nbsp;- Cuando Facturaci√≥n detecta un pago, pone un evento "ClientePagado" en Redis
                            <br>&nbsp;&nbsp;- El Servicio MTIK escucha esa cola y ejecuta reactivaci√≥n
                            <br>&nbsp;&nbsp;- Notificaciones funciona 100% basado en colas</li>
                        <li><strong>¬øCuellos de Botella?</strong> El API Gateway y el Servicio de Control de Red (MTIK). El uso de colas (as√≠ncrono) mitiga esto.</li>
                    </ul>
                </div>
            </div>
            
            <!-- Nivel 3: Diagrama de Componentes -->
            <div class="level-section">
                <h2 class="level-title">üîß Nivel 3: Diagrama de Componentes (Ejemplo)</h2>
                <p class="level-description">Este diagrama hace "zoom" dentro de un microservicio. Tomemos el m√°s importante: <strong>Contenedor 8: Microservicio: Control de Red (MTIK)</strong>.</p>
                
                <div class="system-box">
                    <div class="system-title">üõú Microservicio: Control de Red (MTIK)</div>
                </div>
                
                <div class="components-grid">
                    <div class="component-card">
                        <div class="component-title">A. MTIK Controller (mtik.controller.ts)</div>
                        <div class="component-description">
                            <strong>Responsabilidad:</strong> Expone los endpoints HTTP (/api/v1/mtik/cortar, /api/v1/mtik/reactivar). Valida la petici√≥n (ej. que venga de un servicio interno).
                            <br><strong>Tecnolog√≠a:</strong> NestJS Controller
                        </div>
                    </div>
                    <div class="component-card">
                        <div class="component-title">B. MTIK Service (mtik.service.ts)</div>
                        <div class="component-description">
                            <strong>Responsabilidad:</strong> Orquesta la acci√≥n. Recibe la petici√≥n del Controller, busca la IP del cliente en la BBDD y pasa la instrucci√≥n al wrapper de conexi√≥n.
                            <br><strong>Tecnolog√≠a:</strong> NestJS Service
                        </div>
                    </div>
                    <div class="component-card">
                        <div class="component-title">C. MTIK Connection Wrapper (mikrotik.wrapper.ts)</div>
                        <div class="component-description">
                            <strong>Responsabilidad:</strong> Abstrae la conexi√≥n f√≠sica con el router. Tiene dos m√©todos: addToAddressList(ip, listName) y removeFromAddressList(ip).
                            <br><strong>Tecnolog√≠a:</strong> Usa la biblioteca node-routeros o un cliente SSH
                        </div>
                    </div>
                    <div class="component-card">
                        <div class="component-title">D. MTIK Queue Listener (queue.listener.ts)</div>
                        <div class="component-description">
                            <strong>Responsabilidad:</strong> Escucha la cola de Redis (ej. eventos "ClientePagado"). Cuando recibe un evento, llama al MTIK Service para ejecutar la reactivaci√≥n.
                            <br><strong>Tecnolog√≠a:</strong> NestJS / BullMQ
                        </div>
                    </div>
                </div>
            </div>
            
            <footer>
                <p>Artefacto 5 de 9 - Diagramas de Arquitectura (Modelo C4) | Sistema de Gesti√≥n para ISP</p>
            </footer>
        </div>
    </div>
</body>
</html>